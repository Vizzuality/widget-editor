(this["webpackJsonp@applications/widget-editor"]=this["webpackJsonp@applications/widget-editor"]||[]).push([[0],{10:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=r(n(137));t.DatasetService=a.default;var i=r(n(139));t.WidgetService=i.default;var c=r(n(64));t.FiltersService=c.default;var o=r(n(140));t.DataService=o.default;var u=r(n(141));t.VegaService=u.default;var s=r(n(145));t.stateProxy=s.default;var l=r(n(86));t.constants=l.default},121:function(e,t,n){"use strict";var r=n(4),a=n(19),i=n(20),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(10),s=o(n(248)),l=function(){function e(t,n){a(this,e),this.endpoint="https://api.resourcewatch.org/v1",this.config=null,this.datasetService=null,this.widgetService=null,this.datasetId=null,this.config=s.default(t),this.datasetId=n,this.datasetService=new u.DatasetService(this.config),this.widgetService=new u.WidgetService(this.config)}return i(e,[{key:"getDataset",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n,a,i,c,o,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.getConfig(),n=t.applications,a=t.env,i=t.locale,"metadata,vocabulary,widget,layer",c="".concat(this.endpoint,"/dataset/").concat(this.datasetId,"?").concat(n.join(","),"&env=").concat(a,"&language=").concat(i,"&includes=").concat("metadata,vocabulary,widget,layer","&page[size]=999"),e.next=5,this.datasetService.fetchData(c);case 5:return o=e.sent,u=o.data,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getFields",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(this.endpoint,"/fields/").concat(this.datasetId),e.next=3,this.datasetService.fetchData(t);case 3:return n=e.sent,a=n.fields,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"getWidget",value:function(e){return c(this,void 0,void 0,r.mark((function t(){var n,a,i,c,o,u,s,l;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.config.getConfig(),a=n.applications,i=n.env,c=n.locale,"metadata",o=this.widgetService.fromDataset(e).id,u="".concat(this.endpoint,"/widget/").concat(o,"?").concat(a.join(","),"&env=").concat(i,"&language=").concat(c,"&includes=").concat("metadata","&page[size]=999"),t.next=6,this.widgetService.fetchWidget(u);case 6:return s=t.sent,l=s.data,t.abrupt("return",l);case 9:case"end":return t.stop()}}),t,this)})))}},{key:"getWidgetData",value:function(e,t){return c(this,void 0,void 0,r.mark((function n(){var a,i,c,o;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=this.widgetService.getDataSqlQuery(e,t),i="".concat(this.endpoint,"/query/").concat(this.datasetId,"?sql=").concat(a),n.next=4,this.widgetService.fetchWidgetData(i);case 4:return c=n.sent,o=c.data,n.abrupt("return",o);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"getLayers",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n,a,i,c,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config.getConfig(),n=t.applications,a=t.env,t.locale,i="".concat(this.endpoint,"/dataset/").concat(this.datasetId,"/layer?app=").concat(n.join(","),"&env=").concat(a,"&page[size]=9999"),e.next=4,this.datasetService.fetchData(i);case 4:return c=e.sent,o=c.data,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e,this)})))}}]),e}();t.default=l},127:function(e,t,n){e.exports=n(249)},132:function(e,t,n){},137:function(e,t,n){"use strict";var r=n(4),a=n(19),i=n(20),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){a(this,e),this.config=t}return i(e,[{key:"fetchData",value:function(e){return c(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if(!((n=t.sent).status>=400)){t.next=6;break}throw new Error(n.statusText);case 6:return t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 11:throw t.prev=11,t.t0=t.catch(0),new Error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))}}]),e}();t.default=o},139:function(e,t,n){"use strict";var r=n(4),a=n(19),i=n(20),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var o=n(85),u=function(){function e(t){a(this,e),this.config=t}return i(e,[{key:"fromDataset",value:function(e){return o.find(e.attributes.widget,(function(e){return!!e.attributes.defaultEditableWidget}))}},{key:"getDataSqlQuery",value:function(e,t){return""}},{key:"fetchWidgetData",value:function(e){return c(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})))}},{key:"fetchWidget",value:function(e){return c(this,void 0,void 0,r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if(!((n=t.sent).status>=400)){t.next=6;break}throw new Error(n.statusText);case 6:return t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 11:throw t.prev=11,t.t0=t.catch(0),new Error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))}}]),e}();t.default=u},140:function(e,t,n){"use strict";var r=n(4),a=n(19),i=n(20),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=o(n(64)),s=n(86),l=function(){function e(t,n,r){a(this,e),this.adapter=t,this.setEditor=n,this.dispatch=r,this.dataset=null,this.widget=null}return i(e,[{key:"getDatasetAndWidgets",value:function(){return c(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.adapter.getDataset();case 2:return this.dataset=e.sent,e.next=5,this.adapter.getWidget(this.dataset);case 5:this.widget=e.sent,this.setEditor({dataset:this.dataset,widget:this.widget}),this.dispatch({type:s.sagaEvents.DATA_FLOW_DATASET_WIDGET_READY});case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getWidgetData",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.widget.attributes.widgetConfig.paramsConfig,n=new u.default(t),e.next=4,n.requestWidgetData();case 4:a=e.sent,this.setEditor({widgetData:a.data}),this.dispatch({type:s.sagaEvents.DATA_FLOW_WIDGET_DATA_READY});case 7:case"end":return e.stop()}}),e,this)})))}},{key:"getFieldsAndLayers",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.adapter.getFields();case 2:return t=e.sent,e.next=5,this.adapter.getLayers();case 5:n=e.sent,this.setEditor({layers:n,fields:t}),this.dispatch({type:s.sagaEvents.DATA_FLOW_DATA_READY});case 8:case"end":return e.stop()}}),e,this)})))}},{key:"resolveInitialState",value:function(){return c(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDatasetAndWidgets();case 2:return e.next=4,this.getWidgetData();case 4:return e.next=6,this.getFieldsAndLayers();case 6:case"end":return e.stop()}}),e,this)})))}}]),e}();t.default=l},141:function(e,t,n){"use strict";var r=n(19),a=n(20),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=i(n(142)),o=i(n(143)),u=n(144),s=n(42),l=function(){function e(t,n,a){r(this,e),this.schema=s.defaultVegaSchema(),this.widgetConfig=t,this.widgetData=n,this.configuration=a,this.setConfig(),this.resolveChart()}return a(e,[{key:"resolveChart",value:function(){var e,t=this.configuration.chartType;if(-1===u.SUPPORTED_CHARTS.indexOf(t))throw new Error("Chart of type: ".concat(t," is not supported. we support: (").concat(u.SUPPORTED_CHARTS.join("|"),")"));"pie"===t&&(e=new c.default(this.schema,this.widgetConfig,this.widgetData).getChart()),"bars"===t&&(e=new o.default(this.schema,this.widgetConfig,this.widgetData).getChart()),this.schema=Object.assign(Object.assign({},this.schema),e)}},{key:"setConfig",value:function(){this.schema=Object.assign(Object.assign({},this.schema),{config:this.widgetConfig.config})}},{key:"getChart",value:function(){return this.schema}}]),e}();t.default=l},142:function(e,t,n){"use strict";var r=n(19),a=n(20);Object.defineProperty(t,"__esModule",{value:!0});var i=n(42),c=function(){function e(t,n,a){r(this,e),this.schema=t,this.widgetConfig=n,this.widgetData=a,this.generateSchema()}return a(e,[{key:"generateSchema",value:function(){this.schema=Object.assign(Object.assign({},this.schema),{scales:this.setScales(),marks:this.setMarks(),data:this.bindData()})}},{key:"setScales",value:function(){return[{name:"c",type:"ordinal",domain:{data:"table",field:i.sqlFields.value},range:{scheme:"category20"}}]}},{key:"setMarks",value:function(){return[{type:"arc",from:{data:"table"},encode:{enter:{fill:{scale:"c",field:i.sqlFields.value},x:{signal:"width / 2"},y:{signal:"height / 2"}},update:{startAngle:{field:"startAngle"},endAngle:{field:"endAngle"},innerRadius:{signal:"width > height ? height / 3 : width / 3"},outerRadius:{signal:"width > height ? height / 2 : width / 2"}},hover:{opacity:{value:.8}}}}]}},{key:"bindData",value:function(){return[{values:this.widgetData,name:"table",transform:[{type:"pie",field:i.sqlFields.category,startAngle:0,endAngle:6.29}]}]}},{key:"getChart",value:function(){return this.schema}}]),e}();t.default=c},143:function(e,t,n){"use strict";var r=n(19),a=n(20);Object.defineProperty(t,"__esModule",{value:!0});var i=n(42),c=function(){function e(t,n,a){r(this,e),this.schema=t,this.widgetConfig=n,this.widgetData=a,this.generateSchema()}return a(e,[{key:"generateSchema",value:function(){this.schema=Object.assign(Object.assign({},this.schema),{axes:this.setAxes(),scales:this.setScales(),marks:this.setMarks(),data:this.bindData()})}},{key:"setScales",value:function(){return[{name:"xscale",type:"band",domain:{data:"table",field:i.sqlFields.value},range:"width",padding:.05,round:!0},{name:"yscale",domain:{data:"table",field:i.sqlFields.category},nice:!0,range:"height"}]}},{key:"setMarks",value:function(){return[{type:"rect",from:{data:"table"},encode:{enter:{x:{scale:"xscale",field:i.sqlFields.value},width:{scale:"xscale",band:1},y:{scale:"yscale",field:i.sqlFields.category},y2:{scale:"yscale",value:0}},update:{fill:{value:"steelblue"}},hover:{fill:{value:"red"}}}}]}},{key:"setAxes",value:function(){return[{orient:"bottom",scale:"xscale"},{orient:"left",scale:"yscale"}]}},{key:"bindData",value:function(){return[{values:this.widgetData,name:"table"}]}},{key:"getChart",value:function(){return this.schema}}]),e}();t.default=c},144:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_CHARTS=["pie","bars"],t.default={SUPPORTED_CHARTS:t.SUPPORTED_CHARTS}},145:function(e,t,n){"use strict";var r=n(4),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=i(n(64)),o=i(n(37)),u={limit:null,chartType:null,value:null};t.default={cache:function(e){u=e},sync:function(e){return a(void 0,void 0,void 0,r.mark((function t(){var n,a,i;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=!!u.limit&&u.limit!==e.limit||!!u.chartType&&u.chartType!==e.chartType||!!u.value&&!o.default(u.value,e.value))){t.next=7;break}return a=new c.default(e),t.next=5,a.requestWidgetData();case 5:return i=t.sent,t.abrupt("return",{hasUpdates:n,widgetData:i.data});case 7:return t.abrupt("return",{hasUpdates:n,widgetData:null});case 8:case"end":return t.stop()}}),t)})))}}},247:function(e,t,n){},248:function(e,t,n){"use strict";var r=n(19),a=n(20);Object.defineProperty(t,"__esModule",{value:!0});var i=n(85),c=function(){function e(t){r(this,e),this.setConfig(t)}return a(e,[{key:"setConfig",value:function(e){var t=i.pick(e,["url","env","applications","authUrl","assetsPath","userToken","userEmail","locale"]);this.config=Object.assign(Object.assign({},this.config),t)}},{key:"getConfig",value:function(){return this.config}}]),e}();t.default=function(e){return new c(e)}},249:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"setEditor",(function(){return F})),n.d(r,"default",(function(){return N}));var a={};n.r(a),n.d(a,"setTheme",(function(){return R})),n.d(a,"default",(function(){return q}));var i={};n.r(i),n.d(i,"setConfiguration",(function(){return Q})),n.d(i,"patchConfiguration",(function(){return X})),n.d(i,"default",(function(){return $}));var c={};n.r(c),n.d(c,"default",(function(){return Ke}));var o={};n.r(o),n.d(o,"actions",(function(){return r})),n.d(o,"initialState",(function(){return Ze})),n.d(o,"reducers",(function(){return c}));var u={};n.r(u),n.d(u,"default",(function(){return tt}));var s={};n.r(s),n.d(s,"actions",(function(){return a})),n.d(s,"initialState",(function(){return nt})),n.d(s,"reducers",(function(){return u}));var l={};n.r(l),n.d(l,"setWidget",(function(){return rt})),n.d(l,"default",(function(){return at}));var f={};n.r(f),n.d(f,"default",(function(){return ot}));var d={};n.r(d),n.d(d,"actions",(function(){return l})),n.d(d,"initialState",(function(){return ut})),n.d(d,"reducers",(function(){return f}));var p={};n.r(p),n.d(p,"default",(function(){return ft}));var h={};n.r(h),n.d(h,"actions",(function(){return i})),n.d(h,"initialState",(function(){return dt})),n.d(h,"reducers",(function(){return p}));var g={};n.r(g),n.d(g,"sampleAction",(function(){return Ft})),n.d(g,"default",(function(){return Nt}));var v={};n.r(v),n.d(v,"default",(function(){return qt}));var b={};n.r(b),n.d(b,"actions",(function(){return g})),n.d(b,"initialState",(function(){return Lt})),n.d(b,"reducers",(function(){return v}));var m=n(1),y=n.n(m),O=n(21),w=n.n(O),j=(n(132),n(59)),x=n(3),E=n(15),_=n(112),P=n(13),A=n(12),D=n(60),S=n(54),k=n(61),C=n(16),T=n(10),I=function(e,t){return Object(j.b)((function(t){return"function"===typeof e?e(t[T.constants.APP_NAMESPACE]):{}}),t)},M=function(e){return Object(C.createAction)("".concat(T.constants.APP_NAMESPACE,"/").concat(e))},W=function(e){return"".concat(T.constants.APP_NAMESPACE,"/").concat(e)},F=M("EDITOR/setEditor"),N={setEditor:F},R=M("THEME/setTheme"),q={setTheme:R},L=n(7),U=n(37),G=n.n(U),V=n(83),B=n(113),Y=n.n(B),z=(n(114),L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"p6fymh-0"})(["flex 1;display:flex;width:100%;.c-chart{flex:1;text-align:center;}"])),H=function(e){var t=e.editor,n=e.widget,r=Object(m.useRef)(),a=Object(m.useRef)(),i=Object(m.useRef)();return Object(m.useEffect)((function(){if(r.current&&!Y()(n)&&!G()(n,i)){var e=r.current.parentNode.offsetWidth,t=V.b(n);a.current=new V.a(t).width(e/2).initialize(r.current).renderer("canvas").hover().run(),i.current=n}}),[r,t,n]),Object(m.useEffect)((function(){var e=function(){var e=r.current.parentNode.getBoundingClientRect().width;a.current.signal("width",e/2).run("enter")};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}})),y.a.createElement(z,null,y.a.createElement("div",{className:"c-chart",ref:r}))},J=I((function(e){return{editor:e.editor,widget:e.widget}}))(H),Q=M("CONFIGURATION/setConfiguration"),X=M("CONFIGURATION/patchConfiguration"),$={setConfiguration:Q,patchConfiguration:X},K=n(117),Z=n.n(K),ee=n(58);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ne=L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"sc-5wfvth-0"})(["margin:10px;"]),re={control:function(){return{display:"flex",border:"1px solid rgba(202,204,208,0.85)",borderRadius:"4px",padding:"3px 0"}},option:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)}},ae=function(e){var t=e.patchConfiguration,n=e.options,r=e.value;return y.a.createElement(ne,null,y.a.createElement(ee.a,{onChange:function(e){console.log("handle change",t),t({chartType:e.value})},defaultValue:Z()(n,{value:r}),options:n,styles:re}))},ie=I((function(e){return{options:e.configuration.availableCharts,value:e.configuration.chartType}}),{patchConfiguration:X})(ae),ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.09);\n\n  border-color: rgba(26, 28, 34, 0.1);\n  border-style: solid;\n\n  border-width: ".concat(e,"px ").concat(t,"px ").concat(n,"px ").concat(r,"px;\n")},oe=L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"sc-1jp54tw-0"})(["display:flex;flex-flow:column;height:calc(100% - ",");background:#fff;flex:1;width:100%;",""],"100px",ce()),ue=function(){return y.a.createElement(oe,null,y.a.createElement(ie,null),y.a.createElement(J,null))},se=L.c.button.withConfig({displayName:"component__StyledButton",componentId:"l5yyzu-0"})(["cursor:pointer;font-size:16px;color:#393f44;border:1px solid rgba(202,204,208,0.85);background:transparent;padding:10px 20px;border-radius:5px;"," "," ",""],(function(e){return e.type&&"cta"===e.type&&Object(L.b)(["background:",";color:#fff;border:1px solid transparent;"],e.color)}),(function(e){return e.type&&"highlight"===e.type&&Object(L.b)(["color:",";border:1px solid ",";"],e.color,e.color)}),(function(e){return e.type&&"default"===e.type&&Object(L.b)(["&:hover,&.active{","}"],(function(e){return e.color&&Object(L.b)(["border:1px solid ",";color:",";"],e.color,e.color)}))})),le=function(e){var t=e.type,n=void 0===t?"default":t,r=e.theme,a=e.children;return y.a.createElement(se,{color:r.color,type:n},a)},fe=I((function(e){return{theme:e.theme}}))(le),de=n(9),pe=n(119);function he(){return(he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var ge=Object(L.c)(pe.a).withConfig({displayName:"component__StyledSlider",componentId:"ps9f57-0"})(["width:100%;height:7px;flex-basis:70%;"]),ve=L.c.div.withConfig({displayName:"component__StyledThumb",componentId:"ps9f57-1"})(["height:18px;line-height:18px;width:18px;background-color:#fff;border:3px solid ",";border-radius:50%;transform:translateY(-50%);top:50%;cursor:grab;"],(function(e){return e.theme.slider.track})),be=L.c.div.withConfig({displayName:"component__StyledTrack",componentId:"ps9f57-2"})(["top:0;bottom:0;background:",";border-radius:999px;"],(function(e){return 2===e.index?e.theme.slider.track:1===e.index?e.theme.slider.trackBackground:e.theme.slider.track})),me=function(e,t){return y.a.createElement(ve,e)},ye=function(e,t){return y.a.createElement(be,he({},e,{index:t.index}))},Oe=function(e){var t=e.min,n=void 0===t?1:t,r=e.max,a=void 0===r?500:r,i=e.defaultValue,c=void 0===i?500:i,o=e.value,u=e.theme,s=e.onDone,l=e.onChange;return y.a.createElement(L.a,{theme:u},y.a.createElement(ge,{onAfterChange:s,onChange:l,renderTrack:ye,renderThumb:me,value:Number(o),max:a,min:n,defaultValue:c}))},we=I((function(e){return{theme:e.theme}}))(Oe);var je=function(e,t){var n=Object(m.useState)(e),r=Object(de.a)(n,2),a=r[0],i=r[1];return Object(m.useEffect)((function(){var n=setTimeout((function(){i(e)}),t);return function(){clearTimeout(n)}}),[e,t]),a},xe=L.c.div.withConfig({displayName:"flex__FlexContainer",componentId:"sc-1jjiixp-0"})(["display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;label{flex-basis:100%;}"]),Ee=L.c.label.withConfig({displayName:"form-label__FormLabel",componentId:"dg5fl6-0"})(["color:#393f44;font-size:20px;border-bottom:1px solid #e4e4e4;padding:0 0 10px 0;margin:0 0 20px 0;"]),_e=L.c.input.withConfig({displayName:"input__Input",componentId:"sc-1ao902g-0"})(["background:#ffffff;border:1px solid rgba(202,204,208,0.85);border-radius:4px;color:#393f44;padding:14px 10px;font-size:14px;margin-left:20px;"]),Pe=function(e){e.theme;var t=e.limit,n=e.patchConfiguration,r=Object(m.useState)("".concat(t)),a=Object(de.a)(r,2),i=a[0],c=a[1],o=je(i,500),u=function(e){c(e)};return Object(m.useEffect)((function(){o!==t&&null!==o&&n({limit:o})}),[o]),y.a.createElement(xe,null,y.a.createElement(Ee,{htmlFor:"options-limit"},"Limit"),y.a.createElement(we,{onChange:u,value:i}),y.a.createElement(_e,{type:"number",name:"options-limit",min:"1",max:"500",value:i,onChange:function(e){return u(e.target.value)}}))},Ae=I((function(e){return{theme:e.theme,limit:e.configuration.limit}}),{patchConfiguration:X})(Pe),De=n(82);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ce=function(e){return e.editor.dataset},Te=Object(De.a)([function(e){return e.configuration},Ce],(function(e,t){return ke({},t.attributes.metadata[0].attributes.columns[e.value.name],{identifier:e.value.name})})),Ie=Object(De.a)([Ce],(function(e){return e.attributes.widgetRelevantProps.map((function(t){return ke({},e.attributes.metadata[0].attributes.columns[t],{identifier:t})}))}));function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fe=L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"sc-1bmwxtk-0"})(["margin:10px;flex-basis:100%;"]),Ne={control:function(){return{display:"flex",border:"1px solid rgba(202,204,208,0.85)",borderRadius:"4px",padding:"3px 0"}}},Re=function(e){e.theme;var t=e.value,n=e.columns,r=e.configuration,a=e.patchConfiguration;return y.a.createElement(xe,null,y.a.createElement(Ee,{htmlFor:"options-values"},"Values"),y.a.createElement(Fe,null,y.a.createElement(ee.a,{defaultValue:t,onChange:function(e){a({value:We({},r.value,{name:e.identifier,alias:e.alias})})},getOptionLabel:function(e){return e.alias},getOptionValue:function(e){return e.identifier},options:n,styles:Ne})))},qe=I((function(e){return{theme:e.theme,value:Te(e),configuration:e.configuration,widgetRelevantProps:e.editor.dataset.attributes.widgetRelevantProps,columns:Ie(e)}}),{patchConfiguration:X})(Re),Le=L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"sc-1tx06u6-0"})(["flex:1;background:#fff;height:calc(100% - "," - 20px);padding:0 30px;margin:10px 0;",""],"100px",ce(1,1,1,0)),Ue=L.c.ul.withConfig({displayName:"component__StyledList",componentId:"sc-1tx06u6-1"})(["display:flex;justify-content:space-between;padding:20px 0;list-style:none;"]),Ge=L.c.li.withConfig({displayName:"component__StyledListItem",componentId:"sc-1tx06u6-2"})(["color:red;"]),Ve=function(e){e.limit,e.patchConfiguration;return y.a.createElement(Le,null,y.a.createElement(Ue,null,y.a.createElement(Ge,null,y.a.createElement(fe,null,"General")),y.a.createElement(Ge,null,y.a.createElement(fe,null,"Visual style")),y.a.createElement(Ge,null,y.a.createElement(fe,null,"Advanced")),y.a.createElement(Ge,null,y.a.createElement(fe,null,"Table view"))),y.a.createElement(Ae,null),y.a.createElement(qe,null))},Be=I((function(e){return{limit:e.configuration.limit}}),{patchConfiguration:X})(Ve),Ye=L.c.footer.withConfig({displayName:"component__StyledFooter",componentId:"t079zl-0"})(["width:100%;height:",";align-self:flex-end;display:flex;align-items:center;justify-content:space-between;padding:0 30px;"],"100px"),ze=function(){return y.a.createElement(Ye,null,y.a.createElement(fe,{type:"highlight"},"Need help?"),y.a.createElement(fe,{type:"cta"},"Save widget"))},He=L.c.div.withConfig({displayName:"component__StyledContainer",componentId:"sc-1mx32o6-0"})(["width:100%;height:100%;display:flex;flex-flow:wrap;justify-content:space-between;flex-flow:column;@media only screen and (min-width:768px){flex-flow:wrap;}"]),Je=function(e){function t(e){var n;Object(P.a)(this,t);var r=(n=Object(D.a)(this,Object(S.a)(t).call(this,e))).props,a=r.adapter,i=r.setEditor,c=r.dispatch;return new T.DataService(a,i,c).resolveInitialState(),n}return Object(k.a)(t,e),Object(A.a)(t,[{key:"componentDidUpdate",value:function(e){var t=e.theme,n=this.props.theme;G()(n,t)||this.resolveTheme()}},{key:"resolveTheme",value:function(){var e=this.props,t=e.theme;(0,e.dispatch)({type:"THEME/setTheme",payload:t})}},{key:"render",value:function(){var e=this.props.configuration;return y.a.createElement(He,null,y.a.createElement(ue,null),e.limit&&y.a.createElement(Be,null),y.a.createElement(ze,null))}}]),t}(y.a.Component),Qe=I((function(e){return{editor:e.editor,configuration:e.configuration}}),(function(e){return{dispatch:e,setEditor:function(t){return e(F(t))},setTheme:function(t){return e(R(t))}}}))(Je),Xe=function(e){function t(){return Object(P.a)(this,t),Object(D.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(k.a)(t,e),Object(A.a)(t,[{key:"render",value:function(){var e=this.props,t=e.adapter,n=e.theme;return y.a.createElement(Qe,{adapter:t,theme:n})}}]),t}(y.a.Component);function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ke=Object(x.a)({},F,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t.payload)})),Ze={dataset:null,widget:null,widgetData:null};function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var tt=Object(x.a)({},R,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t.payload)})),nt={color:"#C32D7B",slider:{track:"#a3daf3",trackBackground:"#f5f5f5"}},rt=M("WIDGET/setWidget"),at={setWidget:rt};function it(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ct,ot=Object(x.a)({},rt,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?it(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):it(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t.payload)})),ut={};function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ft=(ct={},Object(x.a)(ct,Q,(function(e,t){return lt({},e,{},t.payload)})),Object(x.a)(ct,X,(function(e,t){return lt({},e,{},t.payload)})),ct),dt={visualizationType:"chart",chartType:"pie",availableCharts:[{value:"pie",label:"pie"},{value:"bars",label:"Bars"}]},pt={configuration:Object(C.handleModule)(h),editor:Object(C.handleModule)(o),theme:Object(C.handleModule)(s),widget:Object(C.handleModule)(d)},ht=Object(x.a)({},T.constants.APP_NAMESPACE,Object(E.combineReducers)(pt)),gt=n(122),vt=Object(gt.a)(),bt=n(4),mt=n.n(bt),yt=n(11),Ot=mt.a.mark(jt),wt=mt.a.mark(xt);function jt(){var e,t;return mt.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(yt.e)();case 2:return e=n.sent,t=e.widgetEditor.editor.widget.attributes.widgetConfig,n.next=6,Object(yt.d)(Q(t.paramsConfig));case 6:case"end":return n.stop()}}),Ot)}function xt(){return mt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yt.f)(T.constants.sagaEvents.DATA_FLOW_DATASET_WIDGET_READY,jt);case 2:case"end":return e.stop()}}),wt)}var Et=mt.a.mark(Dt),_t=mt.a.mark(St),Pt=mt.a.mark(kt),At=mt.a.mark(Ct);function Dt(){var e,t,n,r,a,i,c;return mt.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(yt.e)();case 2:return e=o.sent,t=e.widgetEditor,n=t.editor,r=t.configuration,a=n.widgetData,i=n.widget.attributes.widgetConfig,c=new T.VegaService(i,a,r),o.next=11,Object(yt.d)(rt(c.getChart()));case 11:T.stateProxy.cache(r);case 12:case"end":return o.stop()}}),Et)}function St(){var e,t,n;return mt.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(yt.e)();case 2:return e=r.sent,t=e.widgetEditor.configuration,r.next=6,Object(yt.b)(T.stateProxy.sync,t);case 6:if(!(n=r.sent).hasUpdates){r.next=13;break}if(!n.widgetData){r.next=13;break}return r.next=11,Object(yt.d)(F({widgetData:n.widgetData}));case 11:return r.next=13,Object(yt.b)(kt);case 13:case"end":return r.stop()}}),_t)}function kt(){var e,t,n,r,a,i,c;return mt.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(yt.e)();case 2:return e=o.sent,t=e.widgetEditor,n=t.editor,r=t.configuration,a=n.widgetData,i=n.widget.attributes.widgetConfig,c=new T.VegaService(i,a,r),o.next=11,Object(yt.d)(rt(c.getChart()));case 11:case"end":return o.stop()}}),Pt)}function Ct(){return mt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yt.f)(T.constants.sagaEvents.DATA_FLOW_VISUALISATION_READY,Dt);case 2:return e.next=4,Object(yt.f)(W("CONFIGURATION/patchConfiguration"),St);case 4:return e.next=6,Object(yt.f)(T.constants.sagaEvents.DATA_FLOW_PROXY_UPDATE,kt);case 6:case"end":return e.stop()}}),At)}var Tt=mt.a.mark(It);function It(){return mt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(yt.a)([Object(yt.c)(xt),Object(yt.c)(Ct)]);case 2:case"end":return e.stop()}}),Tt)}var Mt=Xe,Wt=n(120),Ft=Object(C.createAction)("SAMPLE-MODULE/sampleAction"),Nt={sampleAction:Ft};function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var qt=Object(x.a)({},Ft,(function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t.payload)})),Lt={};function Ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(n),!0).forEach((function(t){Object(x.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(E.combineReducers)(Gt({sampleModule:Object(C.handleModule)(b)},ht)),n=Object(E.applyMiddleware)(Wt.a,vt),r=Object(_.composeWithDevTools)(n),a=Object(E.createStore)(t,e,r);return vt.run(It),{store:a}},Bt=(n(247),n(121)),Yt=n.n(Bt);var zt=function(){var e=Vt().store,t=new Yt.a({applications:["rw"],env:"production",locale:"en",includes:["metadata","vocabulary","widget","layer"]},"a86d906d-9862-4783-9e30-cdb68cd808b8");return y.a.createElement(j.a,{store:e},y.a.createElement("div",{className:"App"},y.a.createElement("header",{className:"App-header"},"Widget editor V2"),y.a.createElement("div",{className:"widget-editor-wrapper"},y.a.createElement(Mt,{adapter:t,theme:{color:"#C32D7B"},store:e}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));w.a.render(y.a.createElement(zt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},42:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultVegaSchema=function(){return{$schema:"https://vega.github.io/schema/vega/v5.json",width:400,height:279,data:[],legend:[],config:[],signals:[],scales:[],axes:[],marks:[]}},t.sqlFields={value:"x",category:"y"},t.default={defaultVegaSchema:t.defaultVegaSchema,sqlFields:t.sqlFields}},64:function(e,t,n){"use strict";var r=n(4),a=n(19),i=n(20),c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function c(e){try{u(r.next(e))}catch(t){i(t)}}function o(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,o)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});var o=n(42),u=function(){function e(t){a(this,e),this.configuration=t,this.sql="",this.prepareSelectStatement(),this.prepareAggregate(),this.prepareGroupBy(),this.prepareOrderBy(),this.prepareOrder(),this.prepareLimit(),this.debugSql()}return i(e,[{key:"prepareSelectStatement",value:function(){var e=this.configuration.category;this.sql="SELECT ".concat(e.name," as ").concat(o.sqlFields.value)}},{key:"prepareAggregate",value:function(){var e=this.configuration,t=e.aggregateFunction,n=e.value,r=n.name,a=n.tableName;if("SUM"!==t.toUpperCase())throw new Error("Aggragate function (".concat(t,") not implemented in filter service."));this.sql="".concat(this.sql,", SUM(").concat(r,") as ").concat(o.sqlFields.category," FROM ").concat(a)}},{key:"prepareGroupBy",value:function(){this.sql="".concat(this.sql," GROUP BY ").concat(o.sqlFields.value)}},{key:"prepareOrderBy",value:function(){this.sql="".concat(this.sql," ORDER BY ").concat(o.sqlFields.category)}},{key:"prepareOrder",value:function(){this.sql="".concat(this.sql," desc")}},{key:"prepareLimit",value:function(){var e=this.configuration.limit,t=void 0===e?500:e;this.sql="".concat(this.sql," LIMIT ").concat(t)}},{key:"debugSql",value:function(){console.info("sql query",this.sql)}},{key:"requestWidgetData",value:function(){return c(this,void 0,void 0,r.mark((function e(){var t,n,a,i,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.configuration,n=t.value.datasetID,a=t.areaIntersection,e.next=3,fetch("https://api.resourcewatch.org/v1/query/".concat(n,"?sql=").concat(this.sql,"&geostore=").concat(a));case 3:return i=e.sent,e.next=6,i.json();case 6:return c=e.sent,e.abrupt("return",c);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"getData",value:function(){}}]),e}();t.default=u},86:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APP_NAMESPACE="widgetEditor",t.sagaEvents={DATA_FLOW_DATASET_WIDGET_READY:"".concat(t.APP_NAMESPACE,"/SAGAS/DATA_FLOW/dataset_widget_ready"),DATA_FLOW_DATA_READY:"".concat(t.APP_NAMESPACE,"/SAGAS/DATA_FLOW/data_ready"),DATA_FLOW_VISUALISATION_READY:"".concat(t.APP_NAMESPACE,"/SAGAS/DATA_FLOW/visualisation_ready"),DATA_FLOW_WIDGET_DATA_READY:"".concat(t.APP_NAMESPACE,"/SAGAS/DATA_FLOW/visualisation_ready"),DATA_FLOW_PROXY_UPDATE:"".concat(t.APP_NAMESPACE,"/SAGAS/DATA_FLOW/proxy_update")},t.default={APP_NAMESPACE:t.APP_NAMESPACE,sagaEvents:t.sagaEvents}}},[[127,1,2]]]);
//# sourceMappingURL=main.50219d45.chunk.js.map